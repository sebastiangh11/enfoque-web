---
import Container from "./Container.astro";

const whatsappPhone = "525574570826";
const whatsappUrl = `https://wa.me/${whatsappPhone}`;
const quoteMessage = "Hola, quiero una cotización para mi proyecto.";
const quoteWhatsappUrl = `${whatsappUrl}?text=${encodeURIComponent(quoteMessage)}`;
const catalogMessage =
  "Hola, quiero el catálogo en PDF y una cotización. Mi empresa es: _____. Mi proyecto es: _____.";
const catalogWhatsappUrl = `${whatsappUrl}?text=${encodeURIComponent(catalogMessage)}`;

const trustItems = [
  { value: "30+", label: "Años de experiencia" },
  { value: "500+", label: "Proyectos entregados" },
  { value: "MX", label: "Cobertura nacional" },
];

const carouselImages = [
  {
    src: "/images/hero/branding-1.jpeg",
    alt: "Proyecto de branding físico para punto de venta en México",
  },
  {
    src: "/images/hero/branding-2.jpeg",
    alt: "Stand promocional para activación de marca",
  },
  {
    src: "/images/hero/branding-3.jpeg",
    alt: "Papelería corporativa premium para empresa",
  },
  {
    src: "/images/hero/branding-4.jpeg",
    alt: "Aplicación de grabado láser en material publicitario",
  },
  {
    src: "/images/hero/branding-5.jpeg",
    alt: "Impresión textil para uniformes y presencia de marca",
  },
  {
    src: "/images/hero/branding-6.jpeg",
    alt: "Diseño gráfico aplicado a comunicación visual empresarial",
  },
  {
    src: "/images/hero/branding-7.jpeg",
    alt: "Material POP para branding físico en exhibición",
  },
  {
    src: "/images/hero/branding-8.jpeg",
    alt: "Producción publicitaria para lanzamiento de marca",
  },
];
---

<section class="hero relative overflow-hidden py-20 md:py-28 lg:py-32" aria-labelledby="hero-heading">
  <div class="hero-bg absolute inset-0 pointer-events-none" aria-hidden="true"></div>

  <Container class="relative">
    <div class="lg:grid lg:grid-cols-12 lg:gap-12 xl:gap-16 lg:items-center">
      <div class="text-center lg:text-left lg:col-span-6">
        <h1
          id="hero-heading"
          class="text-4xl font-bold tracking-tight leading-[1.06] text-text-primary md:text-5xl lg:text-6xl"
        >
          Publicidad impresa para que tu marca se vea
          <span class="hero-marker">gigante</span>.
        </h1>

        <p class="mx-auto mt-6 max-w-xl text-lg text-text-secondary md:text-xl lg:mx-0">
          Diseñamos y producimos materiales publicitarios premium para empresas.
        </p>

        <div class="mt-10 flex flex-col items-center gap-3 sm:flex-row sm:flex-wrap sm:gap-4 lg:justify-start">
          <a
            href="/#contacto"
            data-cta="hero-quote"
            data-source="hero"
            aria-label="Cotizar proyecto con Enfoque"
            class="inline-flex h-11 items-center justify-center rounded-xl bg-brand-orange px-6 text-sm font-semibold text-white shadow-sm transition hover:bg-brand-orange-hover hover:shadow focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange focus-visible:ring-offset-2"
          >
            Cotizar proyecto
          </a>

          <a
            href={quoteWhatsappUrl}
            target="_blank"
            rel="noopener noreferrer"
            data-cta="hero-whatsapp"
            data-source="hero"
            aria-label="Escribir por WhatsApp a Enfoque"
            class="inline-flex h-11 items-center justify-center gap-2 rounded-xl bg-[#009640] px-5 text-sm font-semibold text-white shadow-sm transition hover:bg-[#007f37] hover:shadow-md hover:shadow-[#009640]/25 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#009640] focus-visible:ring-offset-2"
          >
            <svg viewBox="0 0 24 24" class="h-4 w-4" fill="currentColor" aria-hidden="true">
              <path d="M12 2a10 10 0 0 0-8.66 15L2 22l5.14-1.33A10 10 0 1 0 12 2Zm5.68 14.2c-.24.66-1.38 1.23-1.9 1.3-.49.06-1.11.09-1.79-.13-.41-.13-.93-.3-1.6-.58-2.81-1.2-4.64-4.1-4.78-4.3-.14-.2-1.14-1.52-1.14-2.9 0-1.38.72-2.05.98-2.33.26-.29.56-.36.75-.36.19 0 .38 0 .54.01.17.01.4-.06.63.49.24.57.82 1.96.89 2.1.07.14.12.31.02.5-.1.19-.15.31-.3.48-.14.17-.3.38-.43.5-.14.14-.28.29-.12.57.17.28.74 1.22 1.58 1.98 1.08.96 1.99 1.25 2.27 1.39.28.14.44.12.6-.07.17-.19.72-.84.91-1.12.19-.29.38-.24.63-.14.26.09 1.63.77 1.91.92.28.14.47.21.54.33.07.12.07.69-.17 1.35Z" />
            </svg>
            WhatsApp
          </a>

          <a
            href={catalogWhatsappUrl}
            target="_blank"
            rel="noopener noreferrer"
            data-cta="hero-catalog"
            data-source="hero"
            aria-label="Solicitar catálogo en WhatsApp"
            class="inline-flex h-11 items-center justify-center rounded-xl border border-border bg-transparent px-5 text-sm font-semibold text-text-primary transition hover:border-brand-blue hover:text-brand-blue hover:bg-surface/70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange focus-visible:ring-offset-2"
          >
            Solicitar catálogo
          </a>
        </div>

        <p class="mt-3 text-sm text-text-muted lg:pl-1">Respuesta en menos de 24 hrs hábiles.</p>

        <ul
          class="mt-10 flex flex-col divide-y divide-border/45 sm:mx-auto sm:max-w-md lg:mx-0 lg:max-w-none lg:flex-row lg:divide-x lg:divide-y-0"
          aria-label="Indicadores de confianza"
        >
          {trustItems.map((item) => (
            <li class="px-1 py-3 text-left sm:px-2 lg:min-w-[10rem] lg:px-5">
              <p class="text-xl font-semibold leading-none text-text-primary">{item.value}</p>
              <p class="mt-1.5 text-xs text-text-muted sm:text-sm">{item.label}</p>
            </li>
          ))}
        </ul>
      </div>

      <div class="mt-14 lg:mt-0 lg:col-span-6 flex justify-center lg:justify-end">
        <div class="hero-visual-card hero-visual-card-border w-full max-w-[41rem]">
          <div class="rounded-3xl border border-border/50 bg-surface/95 p-3 shadow-[0_25px_60px_-30px_rgba(0,0,0,0.25)] backdrop-blur-sm sm:p-4 md:p-5">
            <div
              class="group relative aspect-[16/10] w-full overflow-hidden rounded-2xl border border-border/70 bg-surface-soft"
              data-hero-carousel
              role="region"
              aria-roledescription="carousel"
              aria-label="Galería de proyectos de branding físico"
              tabindex="0"
            >
              {carouselImages.map((image, index) => (
                <img
                  src={image.src}
                  alt={image.alt}
                  width="1600"
                  height="1000"
                  loading={index === 0 ? "eager" : "lazy"}
                  fetchpriority={index === 0 ? "high" : "auto"}
                  decoding={index === 0 ? "sync" : "async"}
                  class={`hero-slide absolute inset-0 h-full w-full object-cover ${index === 0 ? "is-active" : ""}`}
                  data-slide
                  aria-hidden={index === 0 ? "false" : "true"}
                />
              ))}

              <div class="hero-dots" role="tablist" aria-label="Navegación de imágenes">
                {carouselImages.map((_, index) => (
                  <button
                    type="button"
                    class={`hero-dot ${index === 0 ? "is-active" : ""}`}
                    data-dot
                    data-index={index}
                    role="tab"
                    aria-label={`Mostrar imagen ${index + 1} de ${carouselImages.length}`}
                    aria-selected={index === 0 ? "true" : "false"}
                  ></button>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </Container>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const ctaLinks = document.querySelectorAll("[data-cta][data-source]");

    ctaLinks.forEach((link) => {
      link.addEventListener("click", () => {
        const cta = link.getAttribute("data-cta");
        const source = link.getAttribute("data-source");

        if (!cta || !source) return;

        window.dispatchEvent(
          new CustomEvent("cta_click", {
            detail: {
              cta,
              source,
            },
          })
        );
      });
    });

    const carousel = document.querySelector("[data-hero-carousel]");
    if (!carousel) return;

    const slides = Array.from(carousel.querySelectorAll("[data-slide]"));
    const dots = Array.from(carousel.querySelectorAll("[data-dot]"));
    if (!slides.length) return;

    const reducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    let activeIndex = 0;
    let timer = null;
    let startX = 0;
    let isTouching = false;

    if (reducedMotion) {
      carousel.classList.add("reduced-motion");
    }

    const setActiveSlide = (index) => {
      const nextIndex = (index + slides.length) % slides.length;
      activeIndex = nextIndex;

      slides.forEach((slide, slideIndex) => {
        const isActive = slideIndex === activeIndex;
        slide.classList.toggle("is-active", isActive);
        slide.setAttribute("aria-hidden", isActive ? "false" : "true");
      });

      dots.forEach((dot, dotIndex) => {
        const isActive = dotIndex === activeIndex;
        dot.classList.toggle("is-active", isActive);
        dot.setAttribute("aria-selected", isActive ? "true" : "false");
      });
    };

    const stopAutoplay = () => {
      if (timer) {
        window.clearInterval(timer);
        timer = null;
      }
    };

    const startAutoplay = () => {
      if (reducedMotion || timer) return;
      timer = window.setInterval(() => {
        setActiveSlide(activeIndex + 1);
      }, 7000);
    };

    dots.forEach((dot) => {
      dot.addEventListener("click", () => {
        const index = Number(dot.dataset.index || 0);
        setActiveSlide(index);
      });
    });

    carousel.addEventListener("mouseenter", stopAutoplay);
    carousel.addEventListener("mouseleave", startAutoplay);
    carousel.addEventListener("focusin", stopAutoplay);
    carousel.addEventListener("focusout", (event) => {
      if (!carousel.contains(event.relatedTarget)) {
        startAutoplay();
      }
    });

    carousel.addEventListener("keydown", (event) => {
      if (event.key === "ArrowRight") {
        event.preventDefault();
        stopAutoplay();
        setActiveSlide(activeIndex + 1);
      }

      if (event.key === "ArrowLeft") {
        event.preventDefault();
        stopAutoplay();
        setActiveSlide(activeIndex - 1);
      }
    });

    carousel.addEventListener(
      "touchstart",
      (event) => {
        startX = event.touches[0]?.clientX ?? 0;
        isTouching = true;
        stopAutoplay();
      },
      { passive: true }
    );

    carousel.addEventListener(
      "touchend",
      (event) => {
        if (!isTouching) return;

        const endX = event.changedTouches[0]?.clientX ?? startX;
        const delta = endX - startX;

        if (Math.abs(delta) > 40) {
          setActiveSlide(delta < 0 ? activeIndex + 1 : activeIndex - 1);
        }

        isTouching = false;
        startAutoplay();
      },
      { passive: true }
    );

    window.addEventListener("pagehide", stopAutoplay);
    startAutoplay();
  });
</script>

<style>
  .hero-bg {
    background:
      linear-gradient(
        135deg,
        color-mix(in srgb, var(--brand-blue) 8%, transparent) 0%,
        transparent 50%
      ),
      linear-gradient(
        225deg,
        color-mix(in srgb, var(--brand-orange) 5%, transparent) 0%,
        transparent 40%
      ),
      linear-gradient(
        90deg,
        color-mix(in srgb, var(--brand-blue) 3%, transparent) 1px,
        transparent 1px
      ),
      linear-gradient(
        color-mix(in srgb, var(--brand-blue) 3%, transparent) 1px,
        transparent 1px
      );
    background-size: 100% 100%, 100% 100%, 48px 48px, 48px 48px;
  }

  .hero-visual-card-border {
    padding: 1px;
    border-radius: 1.5rem;
    background: linear-gradient(
      145deg,
      color-mix(in srgb, var(--brand-blue) 24%, transparent),
      color-mix(in srgb, var(--brand-orange) 18%, transparent)
    );
  }

  .hero-visual-card-border > div {
    border-radius: calc(1.5rem - 1px);
  }

  .hero-marker {
    position: relative;
    display: inline-block;
    z-index: 0;
  }

  .hero-marker::after {
    content: "";
    position: absolute;
    left: -0.08em;
    right: -0.08em;
    bottom: 0.08em;
    height: 0.26em;
    border-radius: 0.3em;
    background: color-mix(in srgb, var(--brand-orange) 52%, transparent);
    z-index: -1;
  }

  .hero-visual-card {
    opacity: 0;
    animation: hero-float-in 1s ease-out forwards;
  }

  .hero-slide {
    opacity: 0;
    transition: opacity 700ms ease;
  }

  .hero-slide.is-active {
    opacity: 1;
  }

  .hero-dots {
    position: absolute;
    left: 50%;
    bottom: 0.7rem;
    transform: translateX(-50%);
    z-index: 20;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.3rem 0.5rem;
    border-radius: 999px;
    background: color-mix(in srgb, white 70%, transparent);
    border: 1px solid color-mix(in srgb, var(--border) 72%, white 28%);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  .hero-dot {
    width: 0.38rem;
    height: 0.38rem;
    border-radius: 999px;
    border: 0;
    background: color-mix(in srgb, var(--text-muted) 35%, white 65%);
    transition: transform 180ms ease, background-color 180ms ease;
  }

  .hero-dot.is-active {
    background: color-mix(in srgb, var(--text-primary) 85%, black 15%);
    width: 1.5rem;
    border-radius: 999px;
  }

  .hero-dot:focus-visible,
  [data-hero-carousel]:focus-visible {
    outline: 2px solid var(--brand-orange);
    outline-offset: 2px;
  }

  [data-hero-carousel].reduced-motion .hero-slide,
  [data-hero-carousel].reduced-motion .hero-dot {
    transition: none;
  }

  @keyframes hero-float-in {
    from {
      opacity: 0;
      transform: translateY(16px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .hero-visual-card {
      animation: none;
      opacity: 1;
    }
  }
</style>
